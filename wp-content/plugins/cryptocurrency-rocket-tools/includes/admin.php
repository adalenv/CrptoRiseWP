<?php// Exit if accessed directlyif ( ! defined( 'ABSPATH' ) ) exit;class CRToolsAdmin{    const NONCE = 'crtools-admin-settings';    // private static $styles = array();    public static function init() {        // TODO get style        /*self::$styles = json_decode(file_get_contents( CRTOOLS_URL . 'assets/data/styles.txt'));*/                add_action('admin_menu', array( 'crtoolsAdmin', 'register_menu_page' ));    }    public static function register_menu_page() {        add_menu_page(            __( 'Cryptocurrency Rocket Tools', 'crtools' ),            __( 'CR Tools', 'crtools' ),            'manage_options',            'crtools',            array('crtoolsAdmin', 'crtools_help'),            CRTOOLS_URL . '/assets/images/crtools_icon.png'        );        add_submenu_page(            'crtools',            __( 'Help', 'crtools' ),            __( 'Help', 'crtools' ),            'manage_options',            'crtools',            array('crtoolsAdmin', 'crtools_help')        );        add_submenu_page(            'crtools',            __( 'Settings', 'crtools' ),            __( 'Settings', 'crtools' ),            'manage_options',            'crtools_settings',            array('crtoolsAdmin', 'crtools_settings')        );    }    public static function crtools_help(){        echo '          <div class="wrap crtools-admin">                    <h1>Cryptocurrency Rocket Tools - Help</h1>                        <h3>Cryptocurrency Features</h3>            <ol>            <li>The Table - the table</li>            <li>The Graph - the graph of cryptocurrency historical prices</li>            <li>The Converter - the cryptocurrency converter</li>            </ol>                        <p>This plugin gets data from <a href="https://www.cryptocompare.com/api/" target="_blank">CryptoCompare</a> (no API key required).</p>            <p>This plugin uses: Bootstrap v3.3.7, Datatebles v1.10.15, amCharts v3.21.6, Chart.js v2.7.0.</p>            <p>Designed by <a href="webstulle.com" target="_blank">Webstulle</a></p>                        <p><strong>Available cryptocurrencies:</strong></p>            <p>All cryptocurrencies from <a href="https://www.cryptocompare.com" target="_blank">CryptoCompare</a>. <a href="https://www.cryptocompare.com/api/data/coinlist/" target="_blank">View full JSON list</a>.</p>                        <p><strong>Available currencies:</strong></p>            <p>USD, AUD, BRL, CAD, CHF, CLP, CNY, CZK, DKK, EUR, GBP, HKD, HUF, IDR, ILS, INR, JPY, KRW, MXN, MYR, NOK, NZD, PHP, PKR, PLN, RUB, SEK, SGD, THB, TRY, TWD, ZAR</p>                        <br>            <h3>Instructions for the Table</h3>                        <p>To show the Table, add a shortcode to the text of pages or posts.</p>                        <p><strong>Example shortcodes:</strong></p>                        <pre>            [crtools-table coin="BTC,ETH,XRP,XMR,LTC" fiat="USD,EUR" cols="price,cap,supply,volume,change,graph" pagination="10,20,30"]            [crtools-table coin="BTC"  cols="price,change,graph"]            [crtools-table]            </pre>                        <p><strong>Parameters:</strong></p>            <ul>            <li>coin - list of cryptocurrencies, separated by commas. (Default: all cryptocurrencies)</li>            <li>fiat - list of currencies, separated by commas. (Default: all currencies)</li>            <li>cols - list of table columns, separated by commas. (Default: "price,cap,supply,volume,change,graph"). Number and Name are required.</li>            <li>pagination - show entries, separated by commas. (Default: "10,25")</li>            </ul>                        <p><strong>Table columns:</strong></p>            <ul>            <li>price - Prices</li>            <li>cap - Market Capitalizations</li>            <li>supply - Circulating Supply</li>            <li>volume - Volume</li>            <li>change - % Change</li>            <li>graph - Price Graph.</li>            </ul>                        <br>            <h3>Instructions for the Graph</h3>                        <p>To show the Graph, add a shortcode to the text of pages or posts.</p>                        <p><strong>Example shortcodes:</strong></p>            <pre>            [crtools-graph coin="BTC" fiat="USD,EUR" period="1M,1Y"]            [crtools-graph coin="BTC" fiat="USD,EUR"]            [crtools-graph]            </pre>                        <p><strong>Parameters:</strong></p>            <ul>            <li>coin - cryptocurrency. (Default: BTC)</li>            <li>fiat - list of currencies, separated by commas. (Default: all currencies)</li>            <li>period - list of historical data display periods. (Default: "12H,1D,1W,1M,6M,ALL"). Available: 12H,1D,1W,1M,6M,ALL</li>            </ul>                        <br>            <h3>Instructions for the Converter</h3>                        <p>To show the Converter, add a shortcode to the text of pages or posts.</p>                                    <p><strong>Example shortcodes:</strong></p>            <pre>            [crtools-converter from="BTC,ETH" to="USD,EUR"]            [crtools-converter from="BTC"]            </pre>                        <p><strong>Parameters:</strong></p>            <ul>            <li>from - list of cryptocurrencies or currencies, separated by commas. (Required)</li>            <li>fiat - list of cryptocurrencies or currencies, separated by commas. (Default: all currencies)</li>            </ul>            </div>        ';    }    public static function crtools_settings(){        //check if user has admin capability        if (current_user_can( 'manage_options' )){            /*if (isset($_POST['crtools_table_style'])){                check_admin_referer( self::NONCE );                $style = sanitize_text_field($_POST['crtools_table_style']);                update_option('crtools_table_style', $style);                $admin_message_html = '<div class="notice notice-success"><p>Plugin settings have been updated!</p></div>';            }            $style = get_option('crtools_table_style');            if($style == 0)                $options = '<option value="0">default</option>';            else                $options = '<option value="0" selected="selected">default</option>';            foreach(self::$styles as $item){                if($style == $item->id)                    $selected = 'selected="selected"';                else                    $selected = '';                $options .= '<option value="'.$item->id.'" '.$selected.'>'.$item->name.'</option>';            }            echo '              <div class="wrap crtools-admin">                        '.$admin_message_html.'                        <h1>Settings</h1><br />                                <form action="" method="post">                  <label>Table style:</label>                          <select name="crtools_table_style">' . $options . '</select>                </form>                      </div>                      ';*/            if (isset($_POST['crtools-css'])){                //check nonce                check_admin_referer( self::NONCE );                $style = sanitize_text_field($_POST['crtools-css']);                update_option('crtools-css', $style);                $admin_message_html = '<div class="notice notice-success"><p>Plugin settings have been updated!</p></div>';            }            echo '              <div class="wrap crtools-admin">                                <h1>Cryptocurrency Rocket Tools - Settings</h1>                        '.$admin_message_html.'                        <br />                                <form action="" method="post">                  <label>Write your custom CSS:</label><br>                 <textarea name="crtools-css" rows="5" cols="50">'.get_option('crtools-css').'</textarea>                                        <br /><br />                                                     '.wp_nonce_field( self::NONCE ).'                           <input type="submit" class="btn-primary" value="Save settings" />                           </form>                      </div>                      ';        }    }}